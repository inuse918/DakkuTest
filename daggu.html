<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-latest.js"></script>
    <link rel="stylesheet" href="css/bootstrap.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css"
        rel="stylesheet">
    <script type="text/javascript" src="js/bootstrap.js"></script>

    <!--JQuery UI-->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
        integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!--slick CDN-->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <link rel="stylesheet" href="css/daggu.css?1">
    <script type="text/javascript" src="daggu.js"></script>

    <!--font-->
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&display=swap" rel="stylesheet">

    <!--html2canvas-->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="shortcut icon" href="img/favicon.ico">
    <link rel="icon" href="img/favicon.ico">
</head>

<body>

    <div id="Topnav">
        <a href="newMain.php" data-html2canvas-ignore="true"><img src="img/arrow_back.png" id="arrowBack"
                class="backArrow"></a>
        <!--화살표-->
        <p id="title">다꾸다꾸다꾸</p>
        <ul class="menu">
            <li><img src="img/마스킹테이프2.png" alt="마스킹 테이프 아이콘"></li>
            <li><img src="img/메모장 아이콘.png" alt="메모장 아이콘"></li>
            <li><img src="img/스티커 아이콘.png" alt="스티커 아이콘"></li>
            <li><img src="img/텍스트 아이콘2.png" alt="텍스트 아이콘"></li>
            <li><img src="img/속지 아이콘.png" alt="속지 아이콘"></li>
            <li><img src="img/쓰레기통수정.png" id="trashIcon"></li>
        </ul>
        <p class="showSwitch">비공개</p>
        <p style="display:none;" class="showSwitch"> 공개</p>

        <div class="complete" data-html2canvas-ignore="true">

            <label class="switch">
                <input type="checkbox" id="switchBox">
                <span class="switchSlider round"></span>
            </label>
            <button class="btn complete_btn">완성</button>
        </div>
    </div>
    <!-- 꾸미는 쪽 -->
    <img class="diary_cover" src="img/다이어리커버1.png" width="1048px" height="636px">
    <img class="diary_paper" src="img/paper/격자.png" width="1000px" height="650px">
    <div class="diary_content"></div>

    <!--완성버튼-->

    <div class="tab_wrap down">
        <!--슬라이드 버튼-->
        <div class="slide_btn" data-html2canvas-ignore="true">
            <input type="checkbox" id="slideIcon">
            <label for="slideIcon">
                <span></span>
                <span></span>
            </label>
        </div>
        <!--탭 메뉴 상단-->
        <ul class="nav nav-tabs nav-justified">
            <li class="active"><a href="#maskingTape" data-toggle="tab">MASKING TAPE</a></li>
            <li><a href="#notePaper" data-toggle="tab">MEMO PAD</a></li>
            <li><a href="#sticker" data-toggle="tab">STICKER</a></li>
            <li><a href="#text" data-toggle="tab">TEXT</a></li>
            <li><a href="#paper" data-toggle="tab">PAPER</a></li>
        </ul>
        <!--탭 메뉴 하단-->
        <div class="tab-content">
            <div class="tab-pane active" id="maskingTape">
                <!--슬라이드-->
                <section class="center slider">
                    <div>
                        <img src="img/maskingTape/color.png">
                    </div>
                    <div>
                        <img src="img/maskingTape/MLBB단색.png">
                    </div>
                    <div>
                        <img src="img/maskingTape/New tro.png">
                    </div>
                    <div>
                        <img src="img/maskingTape/QUESTION.png">
                    </div>
                    <div>
                        <img src="img/maskingTape/universe.png">
                    </div>
                    <div>
                        <img src="img/maskingTape/고구마단색s.png">
                    </div>
                    <div>
                        <img src="img/maskingTape/WEEKDAY.png">
                    </div>
                    <div>
                        <img src="img/maskingTape/남색바탕격자S.png">
                    </div>
                    <div>
                        <img src="img/maskingTape/밤S.png">
                    </div>
                </section>
            </div>
            <div class="tab-pane" id="notePaper">
                <section class="center slider">
                    <div>
                        <img src="img/notePad/ALWAYS.png">
                    </div>
                    <div>
                        <img src="img/notePad/DIARY.png">
                    </div>
                    <div>
                        <img src="img/notePad/Memory.png">
                    </div>
                    <div>
                        <img src="img/notePad/retro.png">
                    </div>
                    <div>
                        <img src="img/notePad/Review Story.png">
                    </div>
                    <div>
                        <img src="img/notePad/구름떡메.png">
                    </div>
                    <div>
                        <img src="img/notePad/꽃.png">
                    </div>
                    <div>
                        <img src="img/notePad/꽃들.png">
                    </div>
                    <div>
                        <img src="img/notePad/달떡메.png">
                    </div>
                </section>
            </div>
            <div class="tab-pane" id="sticker">
                <section class="center slider">
                    <div>
                        <img src="img/stiker/Feelsgood.png">
                    </div>
                    <div>
                        <img src="img/stiker/Goodvibes스티커.png">
                    </div>
                    <div>
                        <img src="img/stiker/PARTY.png">
                    </div>
                    <div>
                        <img src="img/stiker/Peace.png">
                    </div>
                    <div>
                        <img src="img/stiker/travel.png">
                    </div>
                    <div>
                        <img src="img/stiker/강주영_스티커.png">
                    </div>
                    <div>
                        <img src="img/stiker/강주영_스티커2.png">
                    </div>
                    <div>
                        <img src="img/stiker/구름.png">
                    </div>
                    <div>
                        <img src="img/stiker/구름스티커.png">
                    </div>
                </section>
            </div>
            <div class="tab-pane" id="text">
                <form>
                    <textarea placeholder="텍스트를 입력하세요." style="height:200px" class="form-control inputText" rows="10"
                        cols="200"></textarea>
                    <select id="selectFont">
                        <option value="'Do Hyeon', sans-serif">Dohyun</option>
                        <option value="'Nanum Pen Script', cursive">나눔 펜</option>
                    </select>
                    <input type="button" id="text_sizeUp" value="+">
                    <input type="button" id="text_sizeDown" value="-">

                    <button type="button" class="text_btn" value="제출" style="width:60pt;height:30pt;">제출</input>
                </form>
            </div>
            <div class="tab-pane" id="paper">
                <section class="center slider">
                    <div>
                        <img src="img/paper/격자.png">
                    </div>
                    <div>
                        <img src="img/paper/그라데이션-보라노랑.png">
                    </div>
                    <div>
                        <img src="img/paper/그라데이션-블루그린.png">
                    </div>
                    <div>
                        <img src="img/paper/그라데이션-핑크블루.png">
                    </div>
                    <div>
                        <img src="img/paper/그라데이션-혼종.png">
                    </div>
                    <div>
                        <img src="img/paper/노랑.png">
                    </div>
                    <div>
                        <img src="img/paper/보라.png">
                    </div>
                    <div>
                        <img src="img/paper/보라격자.png">
                    </div>
                    <div>
                        <img src="img/paper/블랙.png">
                    </div>

                </section>

            </div>
        </div>
    </div>

    <script>
        //슬라이드 탭메뉴 바꿨을 때 이미지 안 뜨는 거 해결
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $('.slick-slider').slick('setPosition'); // 슬릭 위치 재배치
        });

        // 메뉴 클릭해서 탭메뉴 선택
        $('.menu li').click(function () {
            var idx = $(this).index() + 1;

            if (idx == 6) {
                var src = ($('#trashIcon').attr('src') == 'img/쓰레기통수정.png') ? 'img/쓰레기통 열린 아이콘.png' :
                    'img/쓰레기통수정.png';
                $('#trashIcon').toggleClass('trashOn');
                $('#trashIcon').attr('src', src);

                if ($('#trashIcon').hasClass('trashOn')) {
                    $('.daggu_ele').addClass('trash');
                    $('.daggu_ele').addClass('vibrate-1');

                    $('.daggu_ele_text').addClass('trash');
                    $('.daggu_ele_text').addClass('vibrate-1');

                    // $('.eleGroup').append('<img src="img/criss-cross.png" class="deleteIcon">');

                    $('.daggu_ele').click(function () {
                        if ($('.daggu_ele').hasClass('trash')) {
                            $(this).remove();
                        }
                    });

                    $('.daggu_ele_text').click(function () {
                        if ($('.daggu_ele_text').hasClass('trash')) {
                            $(this).remove();
                        }
                    });

                } else {
                    // $('.deleteIcon').remove();
                    $('.daggu_ele').removeClass('trash');
                    $('.daggu_ele').removeClass('vibrate-1');
                    $('.daggu_ele_text').removeClass('trash');
                    $('.daggu_ele_text').removeClass('vibrate-1');
                }
                return false;
            }

            $('.tab-content div').removeClass('active');
            $('.tab-content div:nth-child(' + idx + ')').addClass('active');
            //$('.slick-slider').slick('refresh');

            $('.slick-slider').slick('setPosition');
            $('.nav li:nth-child(' + idx + ')').tab('show');

            $("input:checkbox[id='slideIcon']").prop("checked", true);

            if ($('.tab_wrap').hasClass('down')) {
                $('.tab_wrap').removeClass('down');
                $('.tab_wrap').css('top', '50%');
            }
        });

        $("#switchBox").click(function () {
            $(".showSwitch").toggle();
        });

        $(function () {
            $("#trash").droppable({
                accept: ".diary_content > div",
                classes: {
                    "ui-droppable-active": "ui-state-highlight"
                },
                drop: function (event, ui) {
                    deleteImage(ui.draggable);
                }
            });
        });

        function deleteImage($item) {
            $item.remove();
        }
        $(".complete_btn").on("click", function () {
            html2canvas(document.querySelector("body")).then(canvas => {
                saveAs(canvas.toDataURL('image/png'), "capture-test.png");
                var photo = canvas.toDataURL("image/png");
                $.ajax({
                    method: 'POST',
                    url: 'photo_upload.php',
                    data: {
                        photo: photo
                    }
                });
            });


        });

        function saveAs(uri, filename) {
            // 캡쳐된 파일을 이미지 파일로 내보낸다.
            var link = document.createElement('a');
            if (typeof link.download === 'string') {
                link.href = uri;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                window.open(uri);
            }
        }

        $("#selectFont").change(function () {
            var selectFont = $("#selectFont option:selected").val();
            $(".inputText").css('font-family', selectFont);
        });
        var textSize = 18;
        $("#text_sizeUp").click(function () {
            textSize++;
            $(".inputText").css('font-size', textSize);
        });
        $("#text_sizeDown").click(function () {
            textSize--;
            $(".inputText").css('font-size', textSize);
        });

        var css_test_idx = 1;
        //이미지 클릭 시 다이어리 부분에 추가, 
        $('img[src^="img/maskingTape/"],img[src^="img/stiker/"], img[src^="img/notePad/"]').click(function () {
            var src = $(event.target).attr("src");
            $('.diary_content').append('<div class="daggu_ele"><div class="eleGroup"><img src=' + src +
                ' width="100%"></div></div>');

            //드래그 가능하게, 이미지 위에 커서 올라갔을 때 커서 변경, 클릭했을때 맨앞으로 오게

            $('.daggu_ele')
                .draggable({
                    containment: ".diary_content",
                    cancel: ".deleteIcon"
                })
                .css('cursor', 'move')
                .css('z-index', css_test_idx)
                .resizable({
                    //비율 유지
                    aspectRatio: true,
                    //마우스 hover 아닐때 핸들러 숨기기
                    autoHide: true,
                })
                .mousedown(function () { // mousedown 이벤트 생성
                    $(this).css('z-index', css_test_idx); // 클릭한 이미지만 z-index 증가시킴
                    css_test_idx++;
                    // 그러면 이미지가 겹칠경우 클릭한 것이 항상 위에 표시됨
                });

            if ($('#trashIcon').hasClass('trashOn')) {
                $('.daggu_ele').addClass('trash');
                $('.daggu_ele').addClass('vibrate-1');
                $('.daggu_ele').click(function () {
                    if ($('.daggu_ele').hasClass('trash')) {
                        $(this).remove();
                    }
                });
            }

        });
        $(".text_btn").click(function () {
            var text = $(".inputText").val();
            var selectFont = $("#selectFont option:selected").val();
            $('.diary_content').append('<div class="daggu_ele_text" style="font-family:' + selectFont +
                ';font-size:' + textSize + 'px;">' + text + '</div>');
            $('.daggu_ele_text')
                .draggable()
                .css('cursor', 'move')
                .css('z-index', css_test_idx)
                .resizable({
                    //비율 유지
                    //aspectRatio: true,
                    //마우스 hover 아닐때 핸들러 숨기기
                    autoHide: true
                })
                .mousedown(function () { // mousedown 이벤트 생성
                    $(this).css('z-index', css_test_idx); // 클릭한 이미지만 z-index 증가시킴
                    css_test_idx++;
                    // 그러면 이미지가 겹칠경우 클릭한 것이 항상 위에 표시됨
                });

            if ($('#trashIcon').hasClass('trashOn')) {
                $('.daggu_ele_text').addClass('trash');
                $('.daggu_ele_text').addClass('vibrate-1');
                $('.daggu_ele_text').click(function () {
                    if ($('.daggu_ele_text').hasClass('trash')) {
                        $(this).remove();
                    }
                });
            }
            $(".inputText").val("");
        });
        //슬라이드 jquery 
        $(".center").slick({
            dots: false,
            infinite: true,
            centerMode: true,
            slidesToShow: 5,
            arrows: true,
            slidesToScroll: 5
        });

        $('#slideIcon').click(function () {
            //슬라이드가 아래로 내려가있는 상태
            if ($('.tab_wrap').hasClass('down')) {
                $("input:checkbox[id='slideIcon']").prop("checked", false);
                // $('.tab_wrap').removeClass('down');
                // $('.tab_wrap').css('top', '50%');
            }
            // 슬라이드 올라와있는 상태
            else {
                $('.tab_wrap').addClass('down');
                $('.tab_wrap').css('top', '100%');
            }
        });


        // 다이어리 속지 변경이벤트
        $('img[src^="img/paper/"]').click(function () {
            var src = $(event.target).attr("src");
            $('.diary_paper').attr("src", src);
        });

        // 새로고침, 뒤로가기 버튼 누르면 경고창 띄움
        $(window).bind("beforeunload", function (e) {
            //return "창을 닫으시겠습니까?";
        });
    </script>

</body>

</html>